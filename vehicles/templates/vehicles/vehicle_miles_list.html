{% extends "index.html" %}
{% load humanize %}
{% block content %}
<div class="container-fluid px-2 px-md-3">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-0">Mileage Log</h1>
      <div class="text-muted small">Business mileage totals will be calculated from these entries</div>
    </div>
    <a class="btn btn-primary" href="{% url 'vehicles:vehicle_miles_add' %}">Add Entry</a>
  </div>

  {% if rows %}
    <div class="row g-3">
      {% for r in rows %}
        <div class="col-12 col-md-6 col-xl-4">
          <div class="card shadow-sm border-0 rounded-4 h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="fw-semibold">{{ r.vehicle.label }}</div>
                  <div class="text-muted small">{{ r.date }} • {{ r.get_mileage_type_display }}</div>
                </div>
                <div class="fw-bold">
                  {% if r.total %}{{ r.total|floatformat:1|intcomma }} mi{% else %}—{% endif %}
                </div>
              </div>

              {% if r.begin or r.end %}
                <div class="mt-2 small text-muted">
                  <div>Begin: {% if r.begin %}{{ r.begin|floatformat:1|intcomma }}{% else %}—{% endif %}</div>
                  <div>End: {% if r.end %}{{ r.end|floatformat:1|intcomma }}{% else %}—{% endif %}</div>
                </div>
              {% endif %}

              {% if r.notes %}
                <div class="mt-2 small text-muted">{{ r.notes }}</div>
              {% endif %}
            </div>

            <div class="card-footer bg-transparent border-0 d-flex gap-2 justify-content-end">
              <a class="btn btn-outline-primary btn-sm" href="{% url 'vehicles:vehicle_miles_edit' r.pk %}">Edit</a>
              {% if request.user.is_staff %}
                <a class="btn btn-outline-danger btn-sm" href="{% url 'vehicles:vehicle_miles_delete' r.pk %}">Delete</a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if is_paginated %}
      <nav class="mt-3">
        <ul class="pagination pagination-sm justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Prev</a></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}

  {% else %}
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body">
        <div class="fw-semibold">No mileage entries yet</div>
        <div class="text-muted small">Add business trips here to power annual mileage reporting.</div>
        <a class="btn btn-primary mt-3" href="{% url 'vehicles:vehicle_miles_add' %}">Add Entry</a>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
