{% extends "index.html" %}
{% block content %}
<div class="container-fluid px-2 px-md-3">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-0">Vehicles</h1>
      <div class="text-muted small">Manage business vehicles for mileage and expense reporting</div>
    </div>
   <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h4 mb-0">Vehicles</h1>
        <div class="text-muted small">Manage business vehicles for mileage and expense reporting</div>
      </div>

      <div class="d-flex gap-2 align-items-center">
        {% if show_archived %}
          <a class="btn btn-outline-secondary" href="{% url 'vehicles:vehicle_list' %}">Hide Archived</a>
        {% else %}
          <a class="btn btn-outline-secondary" href="{% url 'vehicles:vehicle_list' %}?show_archived=1">Show Archived</a>
        {% endif %}
        <a class="btn btn-primary" href="{% url 'vehicles:vehicle_add' %}">Add Vehicle</a>
      </div>
    </div>
  </div>

  {% if vehicles %}
    <div class="row g-3">
      {% for v in vehicles %}
        <div class="col-12 col-md-6 col-xl-4">
          <div class="card shadow-sm border-0 rounded-4 h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start gap-2">
                <div>
                  <div class="fw-semibold">{{ v.label }}</div>
                  <div class="text-muted small">
                    {% if v.year %}{{ v.year }}{% endif %}
                    {% if v.make %}{{ v.make }}{% endif %}
                    {% if v.model %}{{ v.model }}{% endif %}
                  </div>
                </div>
                <span class="badge {% if v.is_active %}text-bg-success{% else %}text-bg-secondary{% endif %}">
                  {% if v.is_active %}Active{% else %}Inactive{% endif %}
                </span>
              </div>

              <div class="mt-3 small text-muted">
                {% if v.plate %}<div>Plate: {{ v.plate }}</div>{% endif %}
                {% if v.vin_last6 %}<div>VIN (last 6): {{ v.vin_last6 }}</div>{% endif %}
              </div>
            </div>

            <div class="card-footer bg-transparent border-0 d-flex gap-2 justify-content-end">
              <a class="btn btn-outline-secondary btn-sm" href="{% url 'vehicles:vehicle_detail' v.pk %}">View</a>
              <a class="btn btn-outline-primary btn-sm" href="{% url 'vehicles:vehicle_edit' v.pk %}">Edit</a>
              <div class="ms-auto d-flex gap-2">
                {% if request.user.is_staff %}
                  <a class="btn btn-outline-danger btn-sm"
                    href="{% url 'vehicles:vehicle_delete' v.pk %}">
                    Delete
                  </a>
                {% endif %}

                {% if v.is_active %}
                  <form method="post" action="{% url 'vehicles:vehicle_archive' v.pk %}">
                    {% csrf_token %}
                    <button class="btn btn-outline-warning btn-sm" type="submit">Archive</button>
                  </form>
                {% else %}
                  <form method="post" action="{% url 'vehicles:vehicle_unarchive' v.pk %}">
                    {% csrf_token %}
                    <button class="btn btn-outline-success btn-sm" type="submit">Unarchive</button>
                  </form>
                {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body">
        <div class="fw-semibold">No vehicles yet</div>
        <div class="text-muted small">Add a business vehicle to enable vehicle selection on transactions.</div>
        <a class="btn btn-primary mt-3" href="{% url 'vehicles:vehicle_add' %}">Add Vehicle</a>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
