{% extends "index.html" %}

{% block title %}Jobs | MoneyPro{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-3 py-3">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-0">Jobs</h1>
      <div class="text-muted small">Track work and link income + expenses for profitability reporting.</div>
    </div>
    <a class="btn btn-primary" href="{% url 'ledger:job_create' %}">New Job</a>
  </div>

  <form method="get" class="row g-2 mb-3">
    <div class="col-12 col-md-5">
      <input class="form-control" name="q" value="{{ q }}" placeholder="Search job #, title, client, city…">
    </div>
    <div class="col-12 col-md-4">
      <select class="form-select" name="job_type">
        <option value="" {% if not job_type %}selected{% endif %}>All job types</option>
        {% for v,l in job_type_choices %}
          <option value="{{ v }}" {% if job_type == v %}selected{% endif %}>{{ l }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-12 col-md-2">
      <select class="form-select" name="active">
        <option value="" {% if not active %}selected{% endif %}>All</option>
        <option value="1" {% if active == "1" %}selected{% endif %}>Active</option>
        <option value="0" {% if active == "0" %}selected{% endif %}>Inactive</option>
      </select>
    </div>
    <div class="col-12 col-md-1 d-grid">
      <button class="btn btn-outline-secondary">Go</button>
    </div>
  </form>

  <!-- Mobile list -->
  <div class="d-md-none">
    {% for j in jobs %}
      <a class="card shadow-sm mb-2 text-decoration-none" href="{% url 'ledger:job_detail' j.pk %}">
        <div class="card-body p-3">
          <div class="d-flex justify-content-between align-items-start gap-2">
            <div class="min-w-0">
              <div class="fw-semibold text-body text-truncate">{{ j.job_number }} • {{ j.title }}</div>
              <div class="small text-muted text-truncate">
                {% if j.client %}{{ j.client.display_name }} • {% endif %}{{ j.get_job_type_display }}
                {% if j.city %} • {{ j.city }}{% endif %}
              </div>
            </div>
            <div class="text-end">
              {% if j.is_active %}
                <span class="badge text-bg-success">Active</span>
              {% else %}
                <span class="badge text-bg-secondary">Inactive</span>
              {% endif %}
            </div>
          </div>
        </div>
      </a>
    {% empty %}
      <div class="text-center text-muted py-4">No jobs yet.</div>
    {% endfor %}

    {% if is_paginated %}
      <nav class="mt-3">
        <ul class="pagination pagination-sm justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ qs }}">Prev</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Prev</span></li>
          {% endif %}

          <li class="page-item disabled"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ qs }}">Next</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>

  <!-- Desktop table -->
  <div class="card shadow-sm d-none d-md-block">
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Job</th>
            <th class="text-muted">Client</th>
            <th class="text-muted">Type</th>
            <th class="text-muted">City</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for j in jobs %}
          <tr>
            <td class="fw-semibold">
              <a class="text-decoration-none" href="{% url 'ledger:job_detail' j.pk %}">{{ j.job_number }} • {{ j.title }}</a>
              {% if not j.is_active %}<span class="badge text-bg-secondary ms-2">Inactive</span>{% endif %}
            </td>
            <td class="text-muted small">{% if j.client %}{{ j.client.display_name }}{% else %}—{% endif %}</td>
            <td class="text-muted small">{{ j.get_job_type_display }}</td>
            <td class="text-muted small">{% if j.city %}{{ j.city }}{% else %}—{% endif %}</td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'ledger:job_update' j.pk %}">Edit</a>
              <a class="btn btn-sm btn-outline-danger" href="{% url 'ledger:job_delete' j.pk %}">Delete</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center text-muted py-4">No jobs yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if is_paginated %}
    <nav class="mt-3 d-none d-md-block">
      <ul class="pagination pagination-sm justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ qs }}">Prev</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Prev</span></li>
        {% endif %}

        <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ qs }}">Next</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

</div>
{% endblock %}
