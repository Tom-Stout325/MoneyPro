{% load humanize %}
{% load formatting %}

<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Invoice {{ invoice.invoice_number }}</title>
  <style>
    @page { size: Letter; margin: 0.6in 0.6in 0.7in 0.6in; }
    html, body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: #111; }
    .muted { color: #666; }
    .row { display: flex; justify-content: space-between; gap: 18px; }
    .col { flex: 1; }
    .right { text-align: right; }
    .h1 { font-size: 20px; font-weight: 700; margin: 0; }
    .h2 { font-size: 12px; font-weight: 700; margin: 0; }
    .box { border: 1px solid #e6e6e6; border-radius: 10px; padding: 10px; }
    .spacer { height: 14px; }
    .small { font-size: 10px; }

    .header { align-items: flex-start; }
    .brand { display: flex; gap: 12px; align-items: flex-start; }
    .logo { width: 120px; height: auto; object-fit: contain; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 6px; vertical-align: top; }
    thead th { border-bottom: 1px solid #ddd; font-size: 10px; text-transform: uppercase; letter-spacing: .04em; color: #555; }
    tbody td { border-bottom: 1px solid #f0f0f0; }
    .num { text-align: right; white-space: nowrap; }

    .totals { width: 260px; margin-left: auto; }
    .totals td { border: none; padding: 4px 0; }
    .totals .label { color: #666; }
    .totals .grand { font-weight: 800; font-size: 13px; }

    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #f3f4f6; font-size: 10px; color: #111; }
:root{
  /* Subtle brand accent. Adjust once, used everywhere. */
  --brand-accent: #2b6cb0; /* a calm blue */
}

.invoice-thanks{
  position: fixed;
  bottom: 62px;  /* sits just above footer */
  left: 0;
  right: 0;
  text-align: center;
  font-size: 12px;
  color: #444;
  letter-spacing: 0.4px;
}

.invoice-footer{
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 55px;
  border-top: 1px solid #e9ecef;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  color: #555;
}

.footer-center{
  text-align: center;
  letter-spacing: 0.2px;
}

.footer-strong{
  font-weight: 600;
  color: #222;
}

.footer-divider{
  margin: 0 10px;
  color: var(--brand-accent);
  opacity: 0.55; /* subtle */
  font-weight: 700;
}

  </style>
</head>
<body>

  <!-- Header -->
  <div class="row header">
    <div class="col">
      <div class="brand">
        {% if company and company.logo %}
          <img class="logo" src="{{ company.logo.url }}" alt="Logo" />
        {% endif %}
        <div>
          <br><br><br>
          <div class="h2">{% if company %}{{ company.company_name }}{% else %}{{ business.name }}{% endif %}</div>
          {% if company %}
            <div class="muted small">
              {% if company.phone %}{{ company.phone_display }}{% endif %}<br>
              {% if company.billing_email %}{% if company.phone %}{% endif %}{{ company.billing_email }}{% endif %}
              {% if company.website %}{% if company.phone or company.billing_email %} · {% endif %}{{ company.website }}{% endif %}
            </div>
            {% if company.address_line1 or company.city %}
              <div class="muted small">
                {{ company.address_line1 }}{% if company.address_line2 %}, {{ company.address_line2 }}{% endif %}<br>
                {{ company.city }}{% if company.state %}, {{ company.state }}{% endif %} {{ company.postal_code }}
              </div>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col right">
      <div class="h1">Invoice</div>
      <div class="h2"># {{ invoice.invoice_number|default:"(draft)" }}</div>
      {% comment %} <div class="small muted">Status: <span class="pill">{{ invoice.get_status_display }}</span></div> {% endcomment %}
    </div>
  </div>

  <div class="spacer"></div>

  <!-- Bill to + meta -->
  <div class="row">
    <div class="col box">
      <div class="h2">Bill To</div>
      <div class="spacer" style="height:6px"></div>

      {% if invoice.bill_to_name %}
        <div><strong>{{ invoice.bill_to_name }}</strong></div>
        {% if invoice.bill_to_email %}<div class="muted">{{ invoice.bill_to_email }}</div>{% endif %}
        {% if invoice.bill_to_address1 %}<div class="muted">{{ invoice.bill_to_address1 }}</div>{% endif %}
        {% if invoice.bill_to_address2 %}<div class="muted">{{ invoice.bill_to_address2 }}</div>{% endif %}
        <div class="muted">
          {{ invoice.bill_to_city }}{% if invoice.bill_to_state %}, {{ invoice.bill_to_state }}{% endif %} {{ invoice.bill_to_postal_code }}
        </div>
      {% else %}
        <div><strong>{{ invoice.contact.display_name }}</strong></div>
        {% if invoice.contact.email %}<div class="muted">{{ invoice.contact.email }}</div>{% endif %}
        {% if invoice.contact.address1 %}<div class="muted">{{ invoice.contact.address1 }}</div>{% endif %}
        {% if invoice.contact.address2 %}<div class="muted">{{ invoice.contact.address2 }}</div>{% endif %}
        <div class="muted">
          {{ invoice.contact.city }}{% if invoice.contact.state %}, {{ invoice.contact.state }}{% endif %} {{ invoice.contact.zip_code }}
        </div>
      {% endif %}
    </div>

    <div class="col box">
      <div class="h2">Details</div>
      <div class="spacer" style="height:6px"></div>
      <table>
        <tr>
          <td class="muted">Issue date</td>
          <td class="right">{{ invoice.issue_date|date:"m/d/Y" }}</td>
        </tr>
        <tr>
          <td class="muted">Due date</td>
          <td class="right">{% if invoice.due_date %}{{ invoice.due_date|date:"m/d/Y" }}{% else %}—{% endif %}</td>
        </tr>
        <tr>
          <td class="muted">Job</td>
          <td class="right">{% if invoice.job %}{{ invoice.job.title }}{% else %}—{% endif %}</td>
        </tr>
        <tr>
          <td class="muted">Location</td>
          <td class="right">{% if invoice.location %}{{ invoice.location }}{% else %}—{% endif %}</td>
        </tr>
      </table>
    </div>
  </div>

  <div class="spacer"></div>

  <!-- Line items -->
  <div class="box">
    <table>
      <thead>
        <tr>
          <th style="width: 48%">Description</th>
          <th style="width: 18%">Category</th>
          <th class="num" style="width: 10%">Qty</th>
          <th class="num" style="width: 12%">Rate</th>
          <th class="num" style="width: 12%">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for item in invoice.items.all %}
          <tr>
            <td>
              <div><strong>{{ item.description }}</strong></div>
              {% if invoice.memo and forloop.first %}
                <div class="muted small" style="margin-top:4px">{{ invoice.memo|linebreaksbr }}</div>
              {% endif %}
            </td>
            <td class="muted">{% if item.subcategory %}{{ item.subcategory.name }}{% else %}—{% endif %}</td>
            <td class="num">{{ item.qty|floatformat:2 }}</td>
            <td class="num">${{ item.unit_price|floatformat:2|intcomma }}</td>
            <td class="num"><strong>${{ item.line_total|floatformat:2|intcomma }}</strong></td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="muted">No line items.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="spacer" style="height:10px"></div>

    <table class="totals">
      <tr>
        <td class="label">Subtotal</td>
        <td class="num">${{ invoice.subtotal|floatformat:2|intcomma }}</td>
      </tr>
      <tr>
        <td class="label grand">Total</td>
        <td class="num grand">${{ invoice.total|floatformat:2|intcomma }}</td>
      </tr>
    </table>
  </div>

  <div class="invoice-thanks">
  Thank you for your business!
</div>
<footer class="invoice-footer">
  <div class="footer-center">
    {% if company %}
      {{ company.company_name }}
    {% else %}
      {{ invoice.business.company_profile.company_name }}
    {% endif %}

    {% with cp=invoice.business.company_profile %}
      {% if cp.billing_email or cp.phone or cp.website %}
        <span class="footer-divider">|</span>
      {% endif %}

      {% if cp.billing_email %}
        <span>{{ cp.billing_email }}</span>
      {% endif %}

      {% if cp.phone %}
        {% if cp.billing_email %}<span class="footer-divider">|</span>{% endif %}
        <span>{{ cp.phone|phone_us }}</span>
      {% endif %}

      {% if cp.website %}
        {% if cp.billing_email or cp.phone %}<span class="footer-divider">|</span>{% endif %}
        <span>{{ cp.website }}</span>
      {% endif %}
    {% endwith %}
  </div>
</footer>





</body>
</html>
